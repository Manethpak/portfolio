---
import { MoonIcon, SunIcon } from "astro-feather";
---

<button
  id="theme-toggle"
  class="p-2 rounded-lg bg-secondary-bg hover:bg-tertiary-bg transition-colors"
  aria-label="Toggle theme"
>
  <SunIcon customClasses="w-5 h-5 text-primary-text dark:hidden" />
  <MoonIcon customClasses="w-5 h-5 text-primary-text hidden dark:block" />
</button>

<script>
  const themeToggle = document.getElementById("theme-toggle");
  const htmlElement = document.documentElement;

  const initTheme = () => {
    const savedTheme = localStorage.getItem("theme");
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches;
    const isDark = savedTheme ? savedTheme === "dark" : prefersDark;

    if (isDark) {
      htmlElement.classList.add("dark");
    } else {
      htmlElement.classList.remove("dark");
    }
  };

  initTheme();

  themeToggle?.addEventListener("click", () => {
    const isDark = htmlElement.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  });

  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", (e) => {
      const savedTheme = localStorage.getItem("theme");
      if (!savedTheme) {
        if (e.matches) {
          htmlElement.classList.add("dark");
        } else {
          htmlElement.classList.remove("dark");
        }
      }
    });
</script>
