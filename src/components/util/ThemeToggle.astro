---
import { Image } from "astro:assets";
---

<button
  id="theme-toggle"
  class="self-end max-w-[80px] sm:max-w-[120px]"
  aria-label="Toggle theme"
>
  <Image
    src="/icon-light-transparent.png"
    alt="Maneth"
    width={120}
    height={120}
    class="dark:hidden w-20 h-20 sm:w-[120px] sm:h-[120px]"
  />
  <Image
    src="/icon-dark-transparent.png"
    alt="Maneth"
    width={120}
    height={120}
    class="hidden dark:block w-20 h-20 sm:w-[120px] sm:h-fit"
  />
  <p class="text-[10px] w-fit text-center">click me to toggle theme!</p>
</button>

<style>
  @keyframes jump {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-12px);
    }
  }

  #theme-toggle.jump {
    animation: jump 0.4s ease-in-out;
  }
</style>

<script>
  const themeToggle = document.getElementById("theme-toggle");
  const htmlElement = document.documentElement;

  const initTheme = () => {
    const savedTheme = localStorage.getItem("theme");
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches;
    const isDark = savedTheme ? savedTheme === "dark" : prefersDark;

    if (isDark) {
      htmlElement.classList.add("dark");
    } else {
      htmlElement.classList.remove("dark");
    }
  };

  initTheme();

  themeToggle?.addEventListener("click", () => {
    const isDark = htmlElement.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");

    // Trigger jump animation
    themeToggle.classList.remove("jump");
    void themeToggle.offsetWidth; // Force reflow to restart animation
    themeToggle.classList.add("jump");
  });

  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", (e) => {
      const savedTheme = localStorage.getItem("theme");
      if (!savedTheme) {
        if (e.matches) {
          htmlElement.classList.add("dark");
        } else {
          htmlElement.classList.remove("dark");
        }
      }
    });
</script>
