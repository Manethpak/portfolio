---
import { Image } from "astro:assets";
---

<button
  id="theme-toggle"
  class="hover:rotate-12 transition-transform"
  aria-label="Toggle theme"
>
  <Image
    src="/icon-light-transparent.png"
    alt="Maneth"
    width={120}
    height={120}
    class="aspect-auto h-fit self-end sm:self-center dark:hidden"
  />
  <Image
    src="/icon-dark-transparent.png"
    alt="Maneth"
    width={120}
    height={120}
    class="aspect-auto h-fit self-end sm:self-center hidden dark:block"
  />
  <p class="text-xs">click me!</p>
</button>

<script>
  const themeToggle = document.getElementById("theme-toggle");
  const htmlElement = document.documentElement;

  const initTheme = () => {
    const savedTheme = localStorage.getItem("theme");
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches;
    const isDark = savedTheme ? savedTheme === "dark" : prefersDark;

    if (isDark) {
      htmlElement.classList.add("dark");
    } else {
      htmlElement.classList.remove("dark");
    }
  };

  initTheme();

  themeToggle?.addEventListener("click", () => {
    const isDark = htmlElement.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  });

  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", (e) => {
      const savedTheme = localStorage.getItem("theme");
      if (!savedTheme) {
        if (e.matches) {
          htmlElement.classList.add("dark");
        } else {
          htmlElement.classList.remove("dark");
        }
      }
    });
</script>
